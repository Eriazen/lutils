<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>lutils.core.data - lutils documentation</title><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../../../_static/shibuya.css?v=14737038" />
    <link media="print" rel="stylesheet" type="text/css" href="../../../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="lutils.core.data"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../../../index.html">
      
      
      <strong>lutils</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials"></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../core.html">Core Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io.html">IO Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plot.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plt_cfg.html">Plot Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utils.html">Helper Functions</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../../index.html"><span itemprop="name">lutils</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../index.html"><span itemprop="name">Module code</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">lutils.core.data</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for lutils.core.data</h1><div class="highlight"><pre>
<span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span data-line="3"><span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
</span><span data-line="4">
</span><span data-line="5"><span class="kn">from</span><span class="w"> </span><span class="nn">lutils.io.parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse_internal_field</span><span class="p">,</span> <span class="n">parse_residuals</span>
</span><span data-line="6"><span class="kn">from</span><span class="w"> </span><span class="nn">lutils.utils.misc</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_of_version</span><span class="p">,</span> <span class="n">check_dir</span>
</span><span data-line="7"><span class="kn">from</span><span class="w"> </span><span class="nn">lutils.core.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataFrame</span>
</span><span data-line="8">
</span><span data-line="9">
<div class="viewcode-block" id="FoamCase">
<a class="viewcode-back" href="../../../core.html#lutils.core.FoamCase">[docs]</a>
</span><span data-line="10"><span class="k">class</span><span class="w"> </span><span class="nc">FoamCase</span><span class="p">:</span>
</span><span data-line="11"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="12"><span class="sd">    A base class representing an OpenFOAM case.</span>
</span><span data-line="13">
</span><span data-line="14"><span class="sd">    This class manages the case directory structure, handles script execution,</span>
</span><span data-line="15"><span class="sd">    and facilitates the loading and storage of post-processing data.</span>
</span><span data-line="16">
</span><span data-line="17"><span class="sd">    Parameters</span>
</span><span data-line="18"><span class="sd">    ----------</span>
</span><span data-line="19"><span class="sd">    case_path : str</span>
</span><span data-line="20"><span class="sd">        The file path to the OpenFOAM case directory.</span>
</span><span data-line="21"><span class="sd">    label : str</span>
</span><span data-line="22"><span class="sd">        A unique label or identifier for the case.</span>
</span><span data-line="23"><span class="sd">    log_dir : str, optional</span>
</span><span data-line="24"><span class="sd">        The directory name where logs will be stored, relative to `case_path`.</span>
</span><span data-line="25"><span class="sd">        Default is &#39;logs/&#39;.</span>
</span><span data-line="26"><span class="sd">    of_version : int, optional</span>
</span><span data-line="27"><span class="sd">        The specific OpenFOAM version used. If 0, the version is auto-detected</span>
</span><span data-line="28"><span class="sd">        from existing logs. Default is 0.</span>
</span><span data-line="29">
</span><span data-line="30"><span class="sd">    Attributes</span>
</span><span data-line="31"><span class="sd">    ----------</span>
</span><span data-line="32"><span class="sd">    of_version : int</span>
</span><span data-line="33"><span class="sd">        The OpenFOAM version number.</span>
</span><span data-line="34"><span class="sd">    of_version_type : str</span>
</span><span data-line="35"><span class="sd">        The type of OpenFOAM distribution (&#39;com&#39; for ESI/OpenCFD, &#39;org&#39; for Foundation).</span>
</span><span data-line="36"><span class="sd">        A dictionary mapping field names to their corresponding FieldData objects.</span>
</span><span data-line="37"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="38">
</span><span data-line="39">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span data-line="40">                 <span class="n">case_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="41">                 <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="42">                 <span class="n">log_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;logs/&#39;</span><span class="p">,</span>
</span><span data-line="43">                 <span class="n">of_version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="44">        <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">case_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
</span><span data-line="45">            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
</span><span data-line="46">                <span class="sa">f</span><span class="s1">&#39;Case path not found or in not a directory.&#39;</span><span class="p">)</span>
</span><span data-line="47">        <span class="bp">self</span><span class="o">.</span><span class="n">_case_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">case_path</span><span class="p">)</span>
</span><span data-line="48">        <span class="bp">self</span><span class="o">.</span><span class="n">_log_dir</span> <span class="o">=</span> <span class="n">log_dir</span>
</span><span data-line="49">        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">label</span>
</span><span data-line="50">        <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="51">
</span><span data-line="52">        <span class="c1"># Check if log folder exists, otherwise create new one</span>
</span><span data-line="53">        <span class="n">check_dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_case_path</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_dir</span><span class="p">)</span>
</span><span data-line="54">
</span><span data-line="55">        <span class="c1"># Set speficied version, else try to get version from logs</span>
</span><span data-line="56">        <span class="k">if</span> <span class="n">of_version</span><span class="p">:</span>
</span><span data-line="57">            <span class="bp">self</span><span class="o">.</span><span class="n">of_version</span> <span class="o">=</span> <span class="n">of_version</span>
</span><span data-line="58">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="59">            <span class="bp">self</span><span class="o">.</span><span class="n">of_version</span> <span class="o">=</span> <span class="n">get_of_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_case_path</span><span class="p">)</span>
</span><span data-line="60">
</span><span data-line="61">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">of_version</span><span class="p">))</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span data-line="62">            <span class="bp">self</span><span class="o">.</span><span class="n">of_version_type</span> <span class="o">=</span> <span class="s1">&#39;com&#39;</span>
</span><span data-line="63">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="64">            <span class="bp">self</span><span class="o">.</span><span class="n">of_version_type</span> <span class="o">=</span> <span class="s1">&#39;org&#39;</span>
</span><span data-line="65">
</span><span data-line="66">    <span class="nd">@property</span>
</span><span data-line="67">    <span class="k">def</span><span class="w"> </span><span class="nf">case_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="68"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Path: The absolute path to the case directory.&quot;&quot;&quot;</span>
</span><span data-line="69">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_case_path</span>
</span><span data-line="70">
</span><span data-line="71">    <span class="nd">@property</span>
</span><span data-line="72">    <span class="k">def</span><span class="w"> </span><span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="73"><span class="w">        </span><span class="sd">&quot;&quot;&quot;str: The case label.&quot;&quot;&quot;</span>
</span><span data-line="74">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span>
</span><span data-line="75">
</span><span data-line="76">    <span class="nd">@property</span>
</span><span data-line="77">    <span class="k">def</span><span class="w"> </span><span class="nf">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="78"><span class="w">        </span><span class="sd">&quot;&quot;&quot;dict[str, FieldData]: A dictionary mapping field names to their corresponding FieldData objects. &quot;&quot;&quot;</span>
</span><span data-line="79">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span>
</span><span data-line="80">
<div class="viewcode-block" id="FoamCase.run_script">
<a class="viewcode-back" href="../../../core.html#lutils.core.FoamCase.run_script">[docs]</a>
</span><span data-line="81">    <span class="k">def</span><span class="w"> </span><span class="nf">run_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span data-line="82">                   <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="83"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="84"><span class="sd">        Executes an arbitrary script within the context of the OpenFOAM case.</span>
</span><span data-line="85">
</span><span data-line="86"><span class="sd">        Parameters</span>
</span><span data-line="87"><span class="sd">        ----------</span>
</span><span data-line="88"><span class="sd">        file_name : str</span>
</span><span data-line="89"><span class="sd">            The path to the script file. If a relative path is provided, it is</span>
</span><span data-line="90"><span class="sd">            resolved relative to the case directory. Absolute paths are used as-is.</span>
</span><span data-line="91">
</span><span data-line="92"><span class="sd">        Raises</span>
</span><span data-line="93"><span class="sd">        ------</span>
</span><span data-line="94"><span class="sd">        FileNotFoundError</span>
</span><span data-line="95"><span class="sd">            If the script file does not exist at the resolved path.</span>
</span><span data-line="96"><span class="sd">        RuntimeError</span>
</span><span data-line="97"><span class="sd">            If the script execution fails (returns a non-zero exit code) or if an</span>
</span><span data-line="98"><span class="sd">            unexpected error occurs during execution.</span>
</span><span data-line="99"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="100">        <span class="n">script_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
</span><span data-line="101">
</span><span data-line="102">        <span class="c1"># Check if script_path is absolute, else run relative to dir case</span>
</span><span data-line="103">        <span class="k">if</span> <span class="n">script_path</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
</span><span data-line="104">            <span class="n">command</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">script_path</span><span class="p">)</span>
</span><span data-line="105">
</span><span data-line="106">            <span class="k">if</span> <span class="ow">not</span> <span class="n">script_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span data-line="107">                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
</span><span data-line="108">                    <span class="sa">f</span><span class="s1">&#39;Script file not found at absolute path: </span><span class="si">{</span><span class="n">script_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span data-line="109">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="110">            <span class="n">full_script_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_path</span> <span class="o">/</span> <span class="n">script_path</span>
</span><span data-line="111">
</span><span data-line="112">            <span class="k">if</span> <span class="ow">not</span> <span class="n">full_script_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span data-line="113">                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
</span><span data-line="114">                    <span class="sa">f</span><span class="s1">&#39;Script file not found inside case directory: </span><span class="si">{</span><span class="n">full_script_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span data-line="115">
</span><span data-line="116">            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;./</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span data-line="117">
</span><span data-line="118">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="119">            <span class="c1"># Run script inside case directory</span>
</span><span data-line="120">            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_path</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="121">        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="122">            <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="123">                <span class="sa">f</span><span class="s1">&#39;Script execution failed for case &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&quot; at path: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">case_path</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span data-line="124">            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span><span data-line="125">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="126">            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span data-line="127">                <span class="sa">f</span><span class="s1">&#39;An unexpected error occured while trying to run script &quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">&quot; for case &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

</span><span data-line="128">
<div class="viewcode-block" id="FoamCase.add_field">
<a class="viewcode-back" href="../../../core.html#lutils.core.FoamCase.add_field">[docs]</a>
</span><span data-line="129">    <span class="k">def</span><span class="w"> </span><span class="nf">add_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span data-line="130">                  <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="131">                  <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="132"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="133"><span class="sd">        Loads field data from a file and registers it to the case.</span>
</span><span data-line="134">
</span><span data-line="135"><span class="sd">        Parameters</span>
</span><span data-line="136"><span class="sd">        ----------</span>
</span><span data-line="137"><span class="sd">        file_path : str</span>
</span><span data-line="138"><span class="sd">            The path to the data file, relative to the case directory.</span>
</span><span data-line="139"><span class="sd">        field_name : str</span>
</span><span data-line="140"><span class="sd">            The unique name (key) to assign to this field data.</span>
</span><span data-line="141"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="142">        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">FieldData</span><span class="p">(</span>
</span><span data-line="143">            <span class="bp">self</span><span class="o">.</span><span class="n">case_path</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span></div>

</span><span data-line="144">
<div class="viewcode-block" id="FoamCase.del_field">
<a class="viewcode-back" href="../../../core.html#lutils.core.FoamCase.del_field">[docs]</a>
</span><span data-line="145">    <span class="k">def</span><span class="w"> </span><span class="nf">del_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span data-line="146">                  <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="147"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="148"><span class="sd">        Removes a specified field from the case.</span>
</span><span data-line="149">
</span><span data-line="150"><span class="sd">        Parameters</span>
</span><span data-line="151"><span class="sd">        ----------</span>
</span><span data-line="152"><span class="sd">        field_name : str</span>
</span><span data-line="153"><span class="sd">            The name of the field to delete.</span>
</span><span data-line="154"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="155">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="156">            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span>
</span><span data-line="157">        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span data-line="158">            <span class="nb">print</span><span class="p">(</span>
</span><span data-line="159">                <span class="sa">f</span><span class="s1">&#39;Field &quot;</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s1">&quot; not &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&quot; fields. Skipping deletion.&#39;</span><span class="p">)</span></div>

</span><span data-line="160">
<div class="viewcode-block" id="FoamCase.add_residuals">
<a class="viewcode-back" href="../../../core.html#lutils.core.FoamCase.add_residuals">[docs]</a>
</span><span data-line="161">    <span class="k">def</span><span class="w"> </span><span class="nf">add_residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span data-line="162">                      <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="163">                      <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="164"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="165"><span class="sd">        Loads residual data from a specified file.</span>
</span><span data-line="166">
</span><span data-line="167"><span class="sd">        Parameters</span>
</span><span data-line="168"><span class="sd">        ----------</span>
</span><span data-line="169"><span class="sd">        file_path : str</span>
</span><span data-line="170"><span class="sd">            The path to the residuals file, relative to the case directory.</span>
</span><span data-line="171"><span class="sd">        fields : list[str], optional</span>
</span><span data-line="172"><span class="sd">            A list of specific residual fields to load. If empty, all available</span>
</span><span data-line="173"><span class="sd">            fields are loaded. Default is an empty list.</span>
</span><span data-line="174"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="175">        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span> <span class="o">=</span> <span class="n">ResidualsData</span><span class="p">(</span>
</span><span data-line="176">            <span class="bp">self</span><span class="o">.</span><span class="n">case_path</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span></div>
</div>

</span><span data-line="177">
</span><span data-line="178">
<div class="viewcode-block" id="FieldData">
<a class="viewcode-back" href="../../../core.html#lutils.core.FieldData">[docs]</a>
</span><span data-line="179"><span class="k">class</span><span class="w"> </span><span class="nc">FieldData</span><span class="p">:</span>
</span><span data-line="180"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="181"><span class="sd">    A container for field data loaded from OpenFOAM output files.</span>
</span><span data-line="182">
</span><span data-line="183"><span class="sd">    Parameters</span>
</span><span data-line="184"><span class="sd">    ----------</span>
</span><span data-line="185"><span class="sd">    case_path : Path</span>
</span><span data-line="186"><span class="sd">        The root path of the OpenFOAM case.</span>
</span><span data-line="187"><span class="sd">    file_path : str</span>
</span><span data-line="188"><span class="sd">        The path to the specific data file, relative to `case_path`.</span>
</span><span data-line="189"><span class="sd">    field_name : str</span>
</span><span data-line="190"><span class="sd">        The name identifying this field.</span>
</span><span data-line="191"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="192">
</span><span data-line="193">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span data-line="194">                 <span class="n">case_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
</span><span data-line="195">                 <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="196">                 <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="197">        <span class="c1"># Parse data into DataFrame</span>
</span><span data-line="198">        <span class="bp">self</span><span class="o">.</span><span class="n">_internal_field</span> <span class="o">=</span> <span class="n">parse_internal_field</span><span class="p">(</span><span class="n">case_path</span> <span class="o">/</span> <span class="n">file_path</span><span class="p">)</span>
</span><span data-line="199">        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">field_name</span>
</span><span data-line="200">
</span><span data-line="201">        <span class="c1"># Filter relevant columns</span>
</span><span data-line="202">        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">]</span>
</span><span data-line="203">        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal_field</span><span class="p">[</span><span class="n">keys</span><span class="p">])</span>
</span><span data-line="204">
</span><span data-line="205">    <span class="nd">@property</span>
</span><span data-line="206">    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="207"><span class="w">        </span><span class="sd">&quot;&quot;&quot;str: The field name.&quot;&quot;&quot;</span>
</span><span data-line="208">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span><span data-line="209">
</span><span data-line="210">    <span class="nd">@property</span>
</span><span data-line="211">    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="212"><span class="w">        </span><span class="sd">&quot;&quot;&quot;DataFrame: A DataFrame containing the parsed internal field data.&quot;&quot;&quot;</span>
</span><span data-line="213">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span><span data-line="214">
<div class="viewcode-block" id="FieldData.get_cells">
<a class="viewcode-back" href="../../../core.html#lutils.core.FieldData.get_cells">[docs]</a>
</span><span data-line="215">    <span class="k">def</span><span class="w"> </span><span class="nf">get_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span data-line="216">                  <span class="n">position_axis</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="217">                  <span class="n">position_value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span data-line="218">                  <span class="n">data_axis</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="219">                  <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span data-line="220"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="221"><span class="sd">        Extracts a subset of cells near a specific coordinate and sorts them.</span>
</span><span data-line="222">
</span><span data-line="223"><span class="sd">        Parameters</span>
</span><span data-line="224"><span class="sd">        ----------</span>
</span><span data-line="225"><span class="sd">        position_axis : str</span>
</span><span data-line="226"><span class="sd">            The axis name to filter by (e.g., &#39;x&#39;, &#39;y&#39;, or &#39;z&#39;).</span>
</span><span data-line="227"><span class="sd">        position_value : float</span>
</span><span data-line="228"><span class="sd">            The target coordinate value along `position_axis`.</span>
</span><span data-line="229"><span class="sd">        data_axis : str</span>
</span><span data-line="230"><span class="sd">            The column name to use for sorting the resulting data.</span>
</span><span data-line="231"><span class="sd">        tol : float</span>
</span><span data-line="232"><span class="sd">            The tolerance radius around `position_value` for cell selection.</span>
</span><span data-line="233">
</span><span data-line="234"><span class="sd">        Returns</span>
</span><span data-line="235"><span class="sd">        -------</span>
</span><span data-line="236"><span class="sd">        DataFrame</span>
</span><span data-line="237"><span class="sd">            A DataFrame containing the filtered cells, sorted by `data_axis`.</span>
</span><span data-line="238"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="239">        <span class="c1"># Get position axis values</span>
</span><span data-line="240">        <span class="n">column_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">_header</span>
</span><span data-line="241">        <span class="n">data_axis_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">position_axis</span><span class="p">]</span>
</span><span data-line="242">
</span><span data-line="243">        <span class="c1"># Find all cells close to position value</span>
</span><span data-line="244">        <span class="n">absolute_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data_axis_values</span><span class="o">-</span><span class="n">position_value</span><span class="p">)</span>
</span><span data-line="245">        <span class="n">filter_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">absolute_diff</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span data-line="246">
</span><span data-line="247">        <span class="c1"># Filter data</span>
</span><span data-line="248">        <span class="n">filtered_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">filter_idx</span><span class="p">]</span>
</span><span data-line="249">
</span><span data-line="250">        <span class="c1"># Sort filtered data</span>
</span><span data-line="251">        <span class="n">sort_column_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">_map</span><span class="p">[</span><span class="n">data_axis</span><span class="p">]</span>
</span><span data-line="252">        <span class="n">sorting_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">[:,</span> <span class="n">sort_column_idx</span><span class="p">])</span>
</span><span data-line="253">        <span class="n">sorted_filtered_data</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="p">[</span><span class="n">sorting_idx</span><span class="p">]</span>
</span><span data-line="254">
</span><span data-line="255">        <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="n">sorted_filtered_data</span><span class="p">)</span></div>
</div>

</span><span data-line="256">
</span><span data-line="257">
<div class="viewcode-block" id="ResidualsData">
<a class="viewcode-back" href="../../../core.html#lutils.core.ResidualsData">[docs]</a>
</span><span data-line="258"><span class="k">class</span><span class="w"> </span><span class="nc">ResidualsData</span><span class="p">:</span>
</span><span data-line="259"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="260"><span class="sd">    A container for residual data loaded from OpenFOAM output files.</span>
</span><span data-line="261">
</span><span data-line="262"><span class="sd">    Parameters</span>
</span><span data-line="263"><span class="sd">    ----------</span>
</span><span data-line="264"><span class="sd">    case_path : Path</span>
</span><span data-line="265"><span class="sd">        The root path of the OpenFOAM case.</span>
</span><span data-line="266"><span class="sd">    file_path : str</span>
</span><span data-line="267"><span class="sd">        The path to the residuals file, relative to `case_path`.</span>
</span><span data-line="268"><span class="sd">    fields : list[str], optional</span>
</span><span data-line="269"><span class="sd">        A list of specific residual fields to extract. If empty, all fields are loaded.</span>
</span><span data-line="270"><span class="sd">        Default is an empty list.</span>
</span><span data-line="271"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="272">
</span><span data-line="273">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span data-line="274">                 <span class="n">case_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
</span><span data-line="275">                 <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="276">                 <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="277">        <span class="c1"># Load residuals</span>
</span><span data-line="278">        <span class="n">residuals</span> <span class="o">=</span> <span class="n">parse_residuals</span><span class="p">(</span><span class="n">case_path</span> <span class="o">/</span> <span class="n">file_path</span><span class="p">)</span>
</span><span data-line="279">
</span><span data-line="280">        <span class="c1"># If no fields given load all, else select provided</span>
</span><span data-line="281">        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
</span><span data-line="282">            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">residuals</span>
</span><span data-line="283">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="284">            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">residuals</span><span class="p">[</span><span class="n">fields</span><span class="p">])</span>
</span><span data-line="285">
</span><span data-line="286">    <span class="nd">@property</span>
</span><span data-line="287">    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="288"><span class="w">        </span><span class="sd">&quot;&quot;&quot;DataFrame: A DataFrame containing the parsed residuals.&quot;&quot;&quot;</span>
</span><span data-line="289">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span></div>

</span><span data-line="290">
</span><span data-line="291">
</span><span data-line="292"><span class="k">class</span><span class="w"> </span><span class="nc">InterpolationData</span><span class="p">:</span>
</span><span data-line="293">    <span class="k">pass</span>
</span><span data-line="294">
</span><span data-line="295">
</span><span data-line="296"><span class="k">class</span><span class="w"> </span><span class="nc">GeometryData</span><span class="p">:</span>
</span><span data-line="297">    <span class="k">pass</span>
</span></pre></div>
        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, eriazen</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials"></div>
    </div>
  </div>
</footer>
      <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../../../_static/shibuya.js?v=c1cf1a6b"></script></body>
</html>